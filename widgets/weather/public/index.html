<html>

<head>
	<style>
		textarea {
			background-color: transparent;
			resize: none;
			border-color: Transparent;
			color: var(--homey-text-color);
			font-size: var(--homey-font-size-default);
			overflow: hidden;
			width: auto;
			height: auto;
			white-space: nowrap;
		}

		textarea:focus {
			outline: none;
		}

		textarea#day0,
		textarea#wind0,
		textarea#sunrise_set,
		textarea#moonrise_set {
			position: absolute;
			left: 5%;
			width: 90%;
			height: auto;
		}

		textarea#day0 {
			top: 4%;
			width: 40%;
			font-size: var(--homey-font-size-xlarge);
		}

		textarea#wind0 {
			top: 20%;
		}

		textarea#sunrise_set {
			top: 28%;
		}

		textarea#moonrise_set {
			top: 36%;
		}

		textarea#highTemp0,
		textarea#lowTemp0,
		textarea#cloud0,
		textarea#rain0 {
			position: absolute;
			left: 72%;
			width: 28%;
			height: auto;
		}

		textarea#highTemp0 {
			top: 4%;
		}

		textarea#lowTemp0 {
			top: 12%;
		}

		textarea#cloud0 {
			top: 28%;
		}

		textarea#rain0 {
			top: 35%;
		}

		img#Icon0 {
			position: absolute;
			left: 60%;
			top: 6%;
			transform: translateX(-50%);
			width: 20%;
			height: auto;
		}

		table {
			position: absolute;
			top: 48%;
			left: 5%;
			width: 90%;
			border-collapse: separate;
			border: none;
			background-color: transparent;
			color: var(--homey-text-color);
			font-size: var(--homey-font-size-default);
			max-height: calc(100% - 48%);
			overflow: auto;
			display: block;
			border-spacing: 5px;
			table-layout: fixed;
		}

		thead,
		tbody {
			display: block;
			overflow: hidden;
		}

		tbody {
			overflow-y: auto;
			max-height: calc(100% - 48%);
		}

		table img {
			width: 50%;
			height: auto;
		}

		table td,
		table th {
			width: 20%;
			max-width: 20%;
			min-width: 20%;
			text-align: center;
			overflow: hidden;
			white-space: nowrap;
			text-overflow: hidden;
		}

		table td img {
			display: block;
			margin: 0 auto;
		}

		table td:first-child,
		table th:first-child {
			width: 25px;
			min-width: 25px;
			max-width: 35px;
			overflow: hidden;
			word-wrap: break-word;
		}

		.separator-line {
			position: absolute;
			top: 47%;
			left: 10px;
			width: 90%;
			height: 1px;
			background-color: rgba(0, 0, 0, 0.2);
		}

		body {
			background: linear-gradient(180deg, rgb(0, 130, 250) 0%, rgba(192, 244, 247, 1) 52%, rgba(236, 242, 244, 1) 60%, rgba(236, 242, 244, 1) 100%);
			transition: background 1s ease;
			font-size: calc(12px + 0.5vw);
		}

		/* Dark Mode */
		.homey-dark-mode body {
			background: linear-gradient(180deg, rgb(25, 25, 112) 0%, rgb(59, 61, 74) 50%, rgb(31, 40, 41) 100%);
		}

		/* Responsive adjustments */
		@media (min-width: 400px) {
			textarea#day0 {
				left: 10%;
				width: 30%;
			}

			img#Icon0 {
				left: 60%;
				width: 15%;
			}

			textarea#highTemp0,
			textarea#lowTemp0,
			textarea#cloud0,
			textarea#rain0 {
				left: 75%;
				width: 15%;
			}

			table {
				left: 5%;
				width: 90%;
			}
		}
	</style>
</head>

<body class="homey-widget-small">
	<textarea id="day0" readonly>Sunday</textarea>
	<img id="Icon0" src="wsymbol_0001_sunny.png">
	<textarea id="highTemp0" readonly>ğŸŒ¡â†‘ 22Â°</textarea>
	<textarea id="lowTemp0" readonly>ğŸŒ¡â†“ -2Â°</textarea>
	<textarea id="wind0" readonly>ğŸ’¨ SSW 5mph</textarea>
	<textarea id="sunrise_set" readonly>ğŸ”† 05:55AM - 06:34PM</textarea>
	<textarea id="moonrise_set" readonly>ğŸŒ™ 06:33PM - 04:20AM</textarea>
	<textarea id="cloud0">ğŸŒ¥ï¸ 35%</textarea>
	<textarea id="rain0">â˜‚ï¸ 35%</textarea>
	<div class="separator-line"></div>
	<table>
		<tbody>
			<tr>
				<td></td>
				<td id="day1">Mon</td>
				<td id="day2">Tu</td>
				<td id="day3">Wed</td>
				<td id="day4">Thu</td>
			</tr>
			<tr>
				<td>ğŸ”†</td>
				<td>
					<img id="dayIcon1" src="">
				</td>
				<td>
					<img id="dayIcon2" src="">
				</td>
				<td>
					<img id="dayIcon3" src="">
				</td>
				<td>
					<img id="dayIcon4" src="">
				</td>
			</tr>
			<tr>
				<td>ğŸŒ¡â†‘</td>
				<td id="highTemp1">22Â°</td>
				<td id="highTemp2">22Â°</td>
				<td id="highTemp3">22Â°</td>
				<td id="highTemp4">22Â°</td>
			</tr>
			<tr>
				<td>â˜‚ï¸</td>
				<td id="dayRain1">35%</td>
				<td id="dayRain2">35%</td>
				<td id="dayRain3">35%</td>
				<td id="dayRain4">35%</td>
			</tr>
			<tr>
				<td>ğŸŒ™</td>
				<td>
					<img id="nightIcon1" src="">
				</td>
				<td>
					<img id="nightIcon2" src="">
				</td>
				<td>
					<img id="nightIcon3" src="">
				</td>
				<td>
					<img id="nightIcon4" src="">
				</td>
			</tr>
			<tr>
				<td>ğŸŒ¡â†“</td>
				<td id="lowTemp1">-2Â°</td>
				<td id="lowTemp2">-2Â°</td>
				<td id="lowTemp3">-2Â°</td>
				<td id="lowTemp4">-2Â°</td>
			</tr>
			<tr>
				<td>â˜‚ï¸</td>
				<td id="nightRain1">35%</td>
				<td id="nightRain2">35%</td>
				<td id="nightRain3">35%</td>
				<td id="nightRain4">35%</td>
			</tr>
		</tbody>
	</table>

	<script type="text/javascript">
		var_Homey = null;
		function onHomeyReady(Homey)
		{
			_Homey = Homey;
			Homey.ready();

			const settings = Homey.getSettings();
			const height = settings.height || 390;
			Homey.setHeight(height);

			Homey.api('GET', `/?deviceId=${settings.devices.id}`, {})
				.then((result) =>
				{
					updateWidget(result);
				})
				.catch(console.error);

			Homey.on('updateWidget', function (deviceId)
			{
				const settings = Homey.getSettings();
				if (settings.devices.id !== deviceId)
				{
					return;
				}

				Homey.api('GET', `/?deviceId=${settings.devices.id}`, {})
					.then((result) =>
					{
						updateWidget(result);
					})
					.catch(console.error);
			});

		}

		function updateWidget(result)
		{
			if (!result)
			{
				return;
			}

			// update todays elements
			const day = result[0];
			document.getElementById(`day0`).value = day.day;
			document.getElementById(`Icon0`).src = day.dayIcon ? day.dayIcon : day.nightIcon; // Updated to use dayIcon
			document.getElementById(`highTemp0`).value = day.highTemp ? `ğŸŒ¡â†‘${day.highTemp}Â°` : "";
			document.getElementById(`lowTemp0`).value = `ğŸŒ¡â†“${day.lowTemp}Â°`; // Updated to use thermometer symbol
			document.getElementById(`wind0`).value = day.dayGustStrength ? `ğŸ’¨ ${day.dayWindAngle} ${day.dayGustStrength}${day.windSpeedUnits}` : `ğŸ’¨ ${day.nightWindAngle} ${day.nightGustStrength}${day.windSpeedUnits}`; // Updated to use dayGustStrength
			document.getElementById(`cloud0`).value = day.dayCloud ? `â˜ï¸ ${day.dayCloud}%` : `â˜ï¸ ${day.nightCloud}%`; // Updated to use dayCloud
			document.getElementById(`rain0`).value = day.dayRain ? `â˜‚ï¸ ${day.dayRain}%` : `â˜‚ï¸ ${day.nightRain}%`; // Updated rain percentage

			// Convert the sunrise and sunset times to a more readable format
			const sunrise = new Date(day.sunrise);
			const sunset = new Date(day.sunset);
			const sunriseHours = sunrise.getHours() % 12 || 12;
			const sunriseMinutes = String(sunrise.getMinutes()).padStart(2, '0');
			const sunsetHours = sunset.getHours() % 12 || 12;
			const sunsetMinutes = String(sunset.getMinutes()).padStart(2, '0');
			const sunriseAmPm = sunrise.getHours() < 12 ? 'AM' : 'PM';
			const sunsetAmPm = sunset.getHours() < 12 ? 'AM' : 'PM';
			const sunriseTime = `${sunriseHours}:${sunriseMinutes}${sunriseAmPm}`;
			const sunsetTime = `${sunsetHours}:${sunsetMinutes}${sunsetAmPm}`;

			const moonrise = new Date(day.moonrise);
			const moonset = new Date(day.moonset);
			const moonriseHours = moonrise.getHours() % 12 || 12;
			const moonriseMinutes = String(moonrise.getMinutes()).padStart(2, '0');
			const moonsetHours = moonset.getHours() % 12 || 12;
			const moonsetMinutes = String(moonset.getMinutes()).padStart(2, '0');
			const moonriseAmPm = moonrise.getHours() < 12 ? 'AM' : 'PM';
			const moonsetAmPm = moonset.getHours() < 12 ? 'AM' : 'PM';
			const moonriseTime = `${moonriseHours}:${moonriseMinutes}${moonriseAmPm}`;
			const moonsetTime = `${moonsetHours}:${moonsetMinutes}${moonsetAmPm}`;

			document.getElementById(`sunrise_set`).innerText = `ğŸ”† ${sunriseTime} - ${sunsetTime}`;
			document.getElementById(`moonrise_set`).innerText = `ğŸŒ™ ${moonriseTime} - ${moonsetTime}`;

			// update the table elements
			for (let i = 1; i < 5; i++)
			{
				const day = result[i];

				// Just use the first 3 characters of the day name
				const dayName = day.day.length > 3 ? day.day.substring(0, 3) : day.day;
				document.getElementById(`day${i}`).innerText = dayName;

				document.getElementById(`highTemp${i}`).innerText = `${day.highTemp}Â°`;
				document.getElementById(`lowTemp${i}`).innerText = `${day.lowTemp}Â°`;
				document.getElementById(`dayRain${i}`).innerText = `${day.dayRain}%`; // Updated rain percentage for day
				document.getElementById(`nightRain${i}`).innerText = `${day.nightRain}%`; // Updated rain percentage for night

				// update the icons
				document.getElementById(`dayIcon${i}`).src = day.dayIcon;
				document.getElementById(`nightIcon${i}`).src = day.nightIcon; // Updated to use nightIcon
			}

		}
	</script>
</body>

</html>